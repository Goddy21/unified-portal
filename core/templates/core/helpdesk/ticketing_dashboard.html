{% extends "base.html" %}
{% load static %}

{% block title %}Ticketing Dashboard{% endblock %}

{% block content %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/ticketing_dashboard.css' %}">
{% endblock %}

<div class="dashboard-grid">

  <!-- KPI Summary Row -->
  <div class="kpi-row">
    <div class="card kpi-card">
      <div class="kpi-content">
        <h3 class="card-title">Daily</h3>
        <h2 id="dailyCount">0</h2>
      </div>
    </div>
    <div class="card kpi-card">
      <div class="kpi-content">
        <h3 class="card-title">Weekly</h3>
        <h2 id="weeklyCount">0</h2>
      </div>
    </div>
    <div class="card kpi-card">
      <div class="kpi-content">
        <h3 class="card-title">Monthly</h3>
        <h2 id="monthlyCount">0</h2>
      </div>
    </div>
    <div class="card kpi-card">
      <div class="kpi-content">
        <h3 class="card-title">Yearly</h3>
        <h2 id="yearlyCount">0</h2>
      </div>
    </div>
  </div>

  <!-- SECTION 2: High-Level Trends -->
  <div class="card wide-card">
    <div class="card-header">
      <h3 class="card-title">Ticket Trends Overview</h3>
      <div class="card-menu"><i class="fas fa-ellipsis-h"></i></div>
    </div>
    <canvas id="overviewChart" class="chart-placeholder line-chart"></canvas>
  </div>

  <div class="card wide-card">
    <div class="card-header">
      <h3 class="card-title">Problem Category Trends Over Time</h3>
      <div class="card-menu"><i class="fas fa-ellipsis-h"></i></div>
    </div>
    <canvas id="categoryTimeChart" class="chart-placeholder bar-chart"></canvas>
  </div>

  <!-- SECTION 3: Distribution Breakdown -->
  <h3 class="section-title">Distribution Breakdown</h3>
  <div class="distribution-row">
    <div class="card">
      <div class="card-header"><h3 class="card-title">Tickets by Priority</h3></div>
      <div class="pie-chart-container">
        <canvas id="priorityChart" class="chart-placeholder pie-chart"></canvas>
        <div class="legend">
          <div class="legend-item"><span class="legend-color-box" style="background:#007bff;"></span> High</div>
          <div class="legend-item"><span class="legend-color-box" style="background:#ffc107;"></span> Medium</div>
          <div class="legend-item"><span class="legend-color-box" style="background:#28a745;"></span> Low</div>
          <div class="legend-item"><span class="legend-color-box" style="background:#dc3545;"></span> Urgent</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header"><h3 class="card-title">Tickets by Status</h3></div>
      <div class="pie-chart-container">
        <canvas id="statusChart" class="chart-placeholder pie-chart"></canvas>
        <div class="legend">
          <div class="legend-item"><span class="legend-color-box" style="background:#28a745;"></span> Open</div>
          <div class="legend-item"><span class="legend-color-box" style="background:#ffc107;"></span> Pending</div>
          <div class="legend-item"><span class="legend-color-box" style="background:#007bff;"></span> In Progress</div>
          <div class="legend-item"><span class="legend-color-box" style="background:#6c757d;"></span> Closed</div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 4: Regional & Terminal Insights -->
  <h3 class="section-title">Regional & Terminal Insights</h3>
  <div class="card">
    <div class="card-header"><h3 class="card-title">Tickets by Region</h3></div>
    <canvas id="regionChart" class="chart-placeholder bar-chart"></canvas>
  </div>

  <div class="card full-width-card terminal-card">
    <div class="card-header">
      <h3 class="card-title">Tickets by Terminal</h3>
      <div class="card-menu"><i class="fas fa-chart-bar"></i></div>
    </div>
    <canvas id="terminalChart" class="chart-placeholder bar-chart"></canvas>
  </div>

  <!-- SECTION 5: Customer Insights -->
  <div class="card wide-card">
    <div class="card-header"><h3 class="card-title">Tickets by Customer</h3></div>
    <canvas id="customerChart" class="chart-placeholder horizontal-bar-chart"></canvas>
  </div>

</div>

{% endblock %}

{% block extra_js %}
<script>
  const STATUS_DATA = {{ status_data|default:'[]'|safe }};
  const PRIORITY_DATA = {{ priority_data|default:'[]'|safe }};
  const REGION_DATA = {{ region_data|default:"[]"|safe }};
  const MONTHLY_DATA = {{ monthly_data|default:'[]'|safe }};
  const TERMINAL_DATA = {{ terminal_data|default:"[]"|safe }};
  const OVERVIEW_DATA = {{ overview_data|default:'[]'|safe }};
  const CATEGORY_TIME_DATA = {{ category_time_data|default:'[]'|safe }};
  const CUSTOMER_DATA = {{ customer_data|default:'[]'|safe }};
  const TIME_DATA = {{ time_data|default:'{}'|safe }};

  document.getElementById("dailyCount").textContent = TIME_DATA.day;
  document.getElementById("weeklyCount").textContent = TIME_DATA.week;
  document.getElementById("monthlyCount").textContent = TIME_DATA.month;
  document.getElementById("yearlyCount").textContent = TIME_DATA.year;

  console.log("STATUS_DATA:", STATUS_DATA);
  console.log("Priority data:", PRIORITY_DATA);
  console.log("Monthly data:", MONTHLY_DATA);
  console.log("Terminal data:", TERMINAL_DATA);
  console.log("Customer data:", CUSTOMER_DATA);
  console.log("Time data:", TIME_DATA);
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="{% static 'js/ticketing_dashboard.js' %}"></script>
{% endblock %}
